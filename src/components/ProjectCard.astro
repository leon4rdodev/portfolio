---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import type { Lang } from "../i18n/ui";
import { useTranslations } from "../i18n/utils";
import Icon from "./Icon.astro";

interface Props {
  lang: Lang;
  name: string;
  description: string;
  tags: string[];
  image: ImageMetadata;
  url: string;
  objectFit?: "cover" | "contain";
}

const {
  lang,
  name,
  description,
  tags,
  image,
  url,
  objectFit = "cover",
} = Astro.props;
const t = useTranslations(lang);
---

<article class="project-card card animate-on-scroll">
  <div
    class="project-card__image"
    data-lightbox-src={image.src}
    data-lightbox-alt={name}
    role="button"
    tabindex="0"
  >
    <Image
      src={image}
      alt={name}
      loading="lazy"
      widths={[400, 600, 800]}
      sizes="(max-width: 768px) 100vw, 50vw"
      style={`object-fit: ${objectFit};`}
    />
    <span class="project-card__zoom">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        <line x1="11" y1="8" x2="11" y2="14"></line>
        <line x1="8" y1="11" x2="14" y2="11"></line>
      </svg>
    </span>
  </div>
  <div class="project-card__content">
    <h3 class="project-card__name">{name}</h3>
    <p class="project-card__description">{description}</p>
    <div class="project-card__tags">
      {tags.map((tag) => <span class="tag">{tag}</span>)}
    </div>
    {
      url && (
        <a
          href={url}
          target="_blank"
          rel="noopener noreferrer"
          class="btn btn--ghost btn--sm"
        >
          {t("projects.visit")}
          <Icon name="external" size={14} />
        </a>
      )
    }
  </div>
</article>

<style>
  .project-card {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-xl);
    align-items: center;
  }

  .project-card__image {
    position: relative;
    border-radius: var(--radius-md);
    overflow: hidden;
    aspect-ratio: 16 / 10;
    background: var(--bg-secondary);
    cursor: pointer;
  }

  .project-card__zoom {
    position: absolute;
    bottom: 12px;
    right: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    color: rgba(255, 255, 255, 0.7);
    opacity: 1;
    transform: scale(1);
    transition: all 0.25s ease;
    pointer-events: none;
  }

  .project-card__image:hover .project-card__zoom {
    transform: scale(1.1);
    color: rgba(255, 255, 255, 1);
  }

  .project-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--transition-slow);
  }

  .project-card:hover .project-card__image img {
    transform: scale(1.03);
  }

  .project-card__name {
    font-size: var(--text-xl);
    font-weight: 600;
    margin-bottom: var(--space-sm);
  }

  .project-card__description {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: var(--space-lg);
  }

  .project-card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin-bottom: var(--space-lg);
  }

  @media (max-width: 768px) {
    .project-card {
      grid-template-columns: 1fr;
      padding: 0;
    }

    .project-card__image {
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .project-card__content {
      padding: 0 var(--space-xl) var(--space-xl);
    }
  }
</style>
